<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>your ip - chomp tools</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Shared Chomp styles -->
    <link rel="stylesheet" href="chomp-shared.css">
    <!-- Tools-specific styles -->
    <link rel="stylesheet" href="tools.css">
    
    <style>
        .info-grid {
            display: grid;
            grid-template-columns: 180px 1fr;
            gap: 8px 15px;
            padding: 20px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        .info-label {
            color: var(--text-secondary);
            font-weight: 400;
            text-transform: lowercase;
            font-size: 0.95em;
        }
        .info-value {
            color: var(--text-primary);
            font-weight: 400;
            word-break: break-word;
            font-size: 0.95em;
        }
        .info-value a {
            color: var(--accent-red);
            text-decoration: none;
            transition: opacity 0.2s;
        }
        .info-value a:hover {
            opacity: 0.7;
        }
        .whois-text {
            padding: 20px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            color: var(--text-primary);
            line-height: 1.5;
            max-height: 500px;
            overflow-y: auto;
        }
        @media (max-width: 600px) {
            .info-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .info-label {
                font-weight: 700;
            }
        }
    </style>
</head>
<body>
    <!-- Theme toggle -->
    <div class="theme-toggle" onclick="toggleTheme()"></div>
    
    <!-- Navigation -->
    <nav>
        <a href="https://tools.chomp.ltd">all tools</a>
    </nav>

    <div class="tool-page">
        <div class="tool-header">
            <img src="https://raw.githubusercontent.com/chomp-chomp-pachewy/chomp-chomp/refs/heads/main/whois.png" alt="what is your ip" style="max-width: 300px; margin-bottom: 30px;">
        </div>

        <div class="tool-actions" style="margin-bottom: 30px;">
            <button class="tool-button" onclick="copyIPInfo()">copy ip info</button>
            <button class="tool-button tool-button-secondary" onclick="copyFullRecord()">copy full record</button>
        </div>

        <div class="section-title" style="color: var(--accent-red); font-size: 1.15em; font-weight: 700; margin-bottom: 15px; text-transform: lowercase;">ip info</div>
        <div class="info-grid">
            <div class="info-label">ip address</div>
            <div class="info-value" id="ipv4">loading...</div>
            
            <div class="info-label">city</div>
            <div class="info-value" id="city">loading...</div>
            
            <div class="info-label">state/region</div>
            <div class="info-value" id="region">loading...</div>
            
            <div class="info-label">postal code</div>
            <div class="info-value" id="postalCode">loading...</div>
            
            <div class="info-label">country</div>
            <div class="info-value" id="country">loading...</div>
            
            <div class="info-label">coordinates</div>
            <div class="info-value" id="coordinates">loading...</div>
            
            <div class="info-label">time zone</div>
            <div class="info-value" id="timezone">loading...</div>
            
            <div class="info-label">local time</div>
            <div class="info-value" id="localTime">loading...</div>
            
            <div class="info-label">isp</div>
            <div class="info-value" id="isp">loading...</div>
            
            <div class="info-label">domain</div>
            <div class="info-value" id="domain">loading...</div>
            
            <div class="info-label">organization</div>
            <div class="info-value" id="organization">loading...</div>
            
            <div class="info-label">asn</div>
            <div class="info-value" id="asn">loading...</div>
            
            <div class="info-label">asn range</div>
            <div class="info-value" id="asnRange">loading...</div>
        </div>

        <div class="info-box">
            <p><strong style="color: var(--accent-red); display: block; margin-bottom: 10px;">about this whois information</strong></p>
            <p>This tool shows detailed information about your public IP address, including your location (city, region, country), internet service provider (ISP), and network details like ASN (Autonomous System Number). The WHOIS data below provides additional technical details about the IP address allocation and network ownership.</p>
        </div>

        <div class="section-title" style="color: var(--accent-red); font-size: 1.15em; font-weight: 700; margin: 30px 0 15px 0; text-transform: lowercase;">ip address whois</div>
        <div class="whois-text" id="whoisText">loading whois data...</div>

        <div class="section-title" style="color: var(--accent-red); font-size: 1.15em; font-weight: 700; margin: 30px 0 15px 0; text-transform: lowercase;">additional details</div>
        <div class="info-grid">
            <div class="info-label">user agent</div>
            <div class="info-value" id="userAgent">loading...</div>
            
            <div class="info-label">screen resolution</div>
            <div class="info-value" id="screenRes">loading...</div>
            
            <div class="info-label">browser language</div>
            <div class="info-value" id="language">loading...</div>
            
            <div class="info-label">platform</div>
            <div class="info-value" id="platform">loading...</div>
            
            <div class="info-label">cookies enabled</div>
            <div class="info-value" id="cookies">loading...</div>
            
            <div class="info-label">do not track</div>
            <div class="info-value" id="dnt">loading...</div>
        </div>

        <div class="toast" id="toast">copied to clipboard!</div>
    </div>

    <script>
<script>
    console.log('=== SCRIPT STARTED ===');
    console.log('Script is loading...');
    
    const API_KEY = '25463b02f43f7899916d89b8eb4043ec';
    let allData = {};
    
    async function getIPAddress() {
        try {
            const response = await fetch(`https://api.whatismyip.com/ip.php?key=${API_KEY}`);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const ip = await response.text();
            document.getElementById('ipv4').textContent = ip.trim();
            allData.ipv4 = ip.trim();
            
            console.log('Calling getIPLookup...');
            await getIPLookup(ip.trim());
            
            console.log('Calling getWhois...');
            await getWhois(ip.trim());
            
            console.log('Calling getHostname...');
            await getHostname(ip.trim());
            
            console.log('All API calls complete');
        } catch (error) {
            console.error('Error fetching IP:', error);
            document.getElementById('ipv4').textContent = 'error loading';
        }
    }
    
    async function getIPLookup(ip) {
        try {
            const response = await fetch(`https://api.whatismyip.com/ip-address-lookup.php?key=${API_KEY}&input=${ip}&output=json`);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const jsonData = await response.json();
            console.log('JSON lookup response:', JSON.stringify(jsonData, null, 2));
            
            // The API returns data in ip_address_lookup array format
            // Get the first (and likely only) element, or if there are two, get the second (the data)
            const lookupArray = jsonData.ip_address_lookup || [];
            const data = lookupArray.length === 1 ? lookupArray[0] : (lookupArray[1] || {});
            
            console.log('Parsed lookup data:', JSON.stringify(data, null, 2));
            console.log('City value:', data.city);
            console.log('Region value:', data.region);
            console.log('ISP value:', data.isp);
            console.log('ASN value:', data.asn);
            
            document.getElementById('city').textContent = data.city || 'n/a';
            document.getElementById('region').textContent = data.region || 'n/a';
            document.getElementById('postalCode').textContent = data.postalcode || 'n/a';
            document.getElementById('country').textContent = data.country || 'n/a';
            document.getElementById('timezone').textContent = data.time || 'n/a';
            document.getElementById('isp').textContent = data.isp || 'n/a';
            document.getElementById('organization').textContent = data.isp || 'n/a';
            
            // ASN with link
            if (data.asn) {
                const asnLink = document.createElement('a');
                asnLink.href = `https://asnlookup.com/asn/AS${data.asn}`;
                asnLink.target = '_blank';
                asnLink.textContent = `AS${data.asn}`;
                document.getElementById('asn').innerHTML = '';
                document.getElementById('asn').appendChild(asnLink);
            } else {
                document.getElementById('asn').textContent = 'n/a';
            }
            
            // Coordinates
            if (data.latitude && data.longitude) {
    const latitude = data.latitude;
    const longitude = data.longitude;

    // 1. Create the link element
    const mapLink = document.createElement('a');

    // 2. Set the href attribute using the coordinates
    // Using a standard Google Maps link format for better compatibility:
    mapLink.href = `https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`;

    // 3. Set the visible text of the link
    mapLink.textContent = `${latitude}, ${longitude}`;

    // 4. Get the target container element
    const coordinatesDisplay = document.getElementById('coordinates');

    // 5. Clear any existing content and append the new link
    coordinatesDisplay.innerHTML = ''; // Clear 'n/a' or previous content
    coordinatesDisplay.appendChild(mapLink);

} else {
    document.getElementById('coordinates').textContent = 'n/a';
}
            
            // Calculate local time from timezone offset
            if (data.time) {
                const now = new Date();
                const localTimeStr = now.toLocaleString('en-US', { 
                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                document.getElementById('localTime').textContent = localTimeStr;
            } else {
                document.getElementById('localTime').textContent = 'n/a';
            }
            
            allData.lookup = data;
        } catch (error) {
            console.error('Error fetching IP lookup:', error);
            document.getElementById('city').textContent = 'error';
            document.getElementById('region').textContent = 'error';
            document.getElementById('postalCode').textContent = 'error';
            document.getElementById('country').textContent = 'error';
            document.getElementById('timezone').textContent = 'error';
            document.getElementById('isp').textContent = 'error';
        }
    }
    
    

async function getWhois(ip) {
    try {
        const response = await fetch(`https://api.whatismyip.com/whois.php?key=${API_KEY}&input=${ip}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        let whois = await response.text();
        
        // Replace the ARIN reporting text with a link
whois = whois.replace(
    /please report at[\s\n]*#[\s\n]*https:\/\/www\.arin\.net\/resources\/registry\/whois\/inaccuracy_reporting\//g,
    'please <a href="https://www.arin.net/resources/registry/whois/inaccuracy_reporting/">report</a> them.'
);

// Replace the Terms of Use text with a link
whois = whois.replace(
    /subject to the Terms of Use[\s\n]*#[\s\n]*available at:\s*https:\/\/www\.arin\.net\/resources\/registry\/whois\/tou\//g,
    'subject to the <a href="https://www.arin.net/resources/registry/whois/tou/">Terms of Use</a>.'
);
        
        document.getElementById('whoisText').innerHTML = whois; // Changed from textContent to innerHTML
        
        // Try to extract ASN and range from WHOIS data
        const asnMatch = whois.match(/AS\d+/);
        const rangeMatch = whois.match(/(\d+\.\d+\.\d+\.\d+)\s*-\s*(\d+\.\d+\.\d+\.\d+)/);
        
        if (asnMatch && !document.getElementById('asn').textContent.includes('loading')) {
            document.getElementById('asn').textContent = asnMatch[0];
        }
        if (rangeMatch) {
    const startIP = rangeMatch[1];
    const endIP = rangeMatch[2];
    const cidr = rangeToCIDR(startIP, endIP);
    document.getElementById('asnRange').textContent = `${cidr} (${startIP} - ${endIP})`;
} else {
    document.getElementById('asnRange').textContent = 'n/a';
}
        
        allData.whois = whois;
    } catch (error) {
        console.error('Error fetching WHOIS:', error);
        document.getElementById('whoisText').textContent = 'error loading whois data';
        document.getElementById('asnRange').textContent = 'n/a';
    }
}
    
    function rangeToCIDR(startIP, endIP) {
    // Convert IP to 32-bit integer
    const ipToInt = (ip) => {
        return ip.split('.').reduce((int, octet) => (int << 8) + parseInt(octet), 0) >>> 0;
    };
    
    const start = ipToInt(startIP);
    const end = ipToInt(endIP);
    
    // Calculate the number of IPs in the range
    const rangeSize = end - start + 1;
    
    // Calculate prefix length (32 - log2 of range size)
    const prefixLength = 32 - Math.floor(Math.log2(rangeSize));
    
    return `${startIP}/${prefixLength}`;
}
    
    async function getHostname(ip) {
        try {
            const response = await fetch(`https://api.whatismyip.com/host-name.php?key=${API_KEY}&input=${ip}`);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const hostname = await response.text();
            document.getElementById('domain').textContent = hostname.trim() || 'n/a';
            allData.hostname = hostname.trim();
        } catch (error) {
            console.error('Error fetching hostname:', error);
            document.getElementById('domain').textContent = 'n/a';
        }
    }
    
    function getBrowserInfo() {
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('screenRes').textContent = `${screen.width} x ${screen.height}`;
        document.getElementById('language').textContent = navigator.language;
        document.getElementById('platform').textContent = navigator.platform;
        document.getElementById('cookies').textContent = navigator.cookieEnabled ? 'yes' : 'no';
        document.getElementById('dnt').textContent = navigator.doNotTrack || 'not set';
    }
    
    function copyIPInfo() {
        const ip = document.getElementById('ipv4').textContent;
        
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(ip).then(() => {
                showToast();
            }).catch(err => {
                fallbackCopy(ip);
            });
        } else {
            fallbackCopy(ip);
        }
    }
    
    function copyFullRecord() {
        let text = 'MY IP ADDRESS\n\n';
        
        const myIPGrid = document.querySelector('#myIPSection .info-grid');
        const labels = myIPGrid.querySelectorAll('.info-label');
        const values = myIPGrid.querySelectorAll('.info-value');
        
        for (let i = 0; i < labels.length; i++) {
            text += `${labels[i].textContent}: ${values[i].textContent}\n`;
        }
        
        text += '\nIP ADDRESS WHOIS\n\n';
        text += document.getElementById('whoisText').textContent + '\n\n';
        
        text += 'ADDITIONAL DETAILS\n\n';
        text += `User Agent: ${document.getElementById('userAgent').textContent}\n`;
        text += `Screen Resolution: ${document.getElementById('screenRes').textContent}\n`;
        text += `Browser Language: ${document.getElementById('language').textContent}\n`;
        text += `Platform: ${document.getElementById('platform').textContent}\n`;
        text += `Cookies Enabled: ${document.getElementById('cookies').textContent}\n`;
        text += `Do Not Track: ${document.getElementById('dnt').textContent}\n`;
        
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(() => {
                showToast();
            }).catch(err => {
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }
    
    function fallbackCopy(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showToast();
            }
        } catch (err) {
            console.error('Fallback copy error:', err);
        }
        
        document.body.removeChild(textArea);
    }
    
    function showToast() {
        const toast = document.getElementById('toast');
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 2000);
    }
    
    getIPAddress();
    getBrowserInfo();

        // Dark mode toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // Load saved theme preference
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
        }
    </script>
</body>
</html>
